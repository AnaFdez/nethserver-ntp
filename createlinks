#!/usr/bin/perl -w

use esmith::Build::CreateLinks qw(:all);

#--------------------------------------------------
# actions for manager panel
#--------------------------------------------------
my $panel = "manager";

panel_link("datetime", $panel);

#--------------------------------------------------
# actions for ip-change event
#--------------------------------------------------

$event = "ip-change";

safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/ntpd");

# Configuration template expansion of ntp.conf
foreach my $file (
    qw(/etc/ntp/step-tickers /etc/ntp.conf /var/service/ntpd/env/MEMLIMIT))
{
    templates2events($file, qw(
	    timeserver-update
	    bootstrap-console-save
	));
}

#--------------------------------------------------
# actions for timeserver-update event
#--------------------------------------------------
 
$event = "timeserver-update";

safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/ntpd");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/syslog");

#--------------------------------------------------
# actions for timezone-update event
#--------------------------------------------------
 
$event = "timezone-update";

event_link("conf-timezone", $event, "30");
event_link("set-time-date", $event, "40");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/crond");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/syslog");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/squid");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/httpd-e-smith");

#--------------------------------------------------
# actions for bootstrap-console-save event
#--------------------------------------------------
 
$event = "bootstrap-console-save";

event_link("conf-timezone", $event, "60");

# Link smbd and nmbd to daemontools.
safe_symlink("../daemontools", "root/etc/rc.d/init.d/supervise/ntpd");

service_link_enhanced("ntpd", "S80", "7");
safe_symlink("../init.d/supervise/ntpd", "root/etc/rc.d/rc6.d/K26ntpd");
safe_symlink("../init.d/supervise/ntpd", "root/etc/rc.d/rc0.d/K26ntpd");
